<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>рд╣рд░рд┐ рдЬрдк рд╕рд╛рдзрдирд╛ - Divine Chanting Counter</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/harijap.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==">
</head>
<body>
    <!-- Divine glow effect -->
    <div class="divine-glow"></div>
    
    <!-- Floating Om symbols -->
    <div class="floating-om om-1">ЁЯХЙя╕П</div>
    <div class="floating-om om-2">ЁЯХЙя╕П</div>
    <div class="floating-om om-3">ЁЯХЙя╕П</div>
    <div class="floating-om om-4">ЁЯХЙя╕П</div>
    <div class="floating-om om-5">ЁЯХЙя╕П</div>

    <div class="container">
        <!-- User Info Section -->
        <div class="user-info">
            <div class="user-name" id="userName">ЁЯЩП рднрдХреНрдд</div>
            <div class="datetime-display" id="datetimeDisplay">--</div>
            <button class="logout-btn" id="logoutBtn">рд▓реЙрдЧрдЖрдЙрдЯ</button>
        </div>

        <!-- Title -->
        <h1 class="title">ЁЯХЙя╕П рд╣рд░рд┐ рдЬрдк рд╕рд╛рдзрдирд╛ ЁЯХЙя╕П</h1>
        
        <!-- Mantra Display -->
        <div class="mantra-container">
            <div class="mantra" id="mantraDisplay">
                <span class="mantra-word" data-word="рдЬрдп" data-index="0">рдЬрдп</span>
                <span class="mantra-word" data-word="рдЬрдп" data-index="1">рдЬрдп</span>
                <span class="mantra-word" data-word="рд░рд╛рдо" data-index="2">рд░рд╛рдо</span>
                <span class="mantra-word" data-word="рдХреГрд╖реНрдгрд╛" data-index="3">рдХреГрд╖реНрдгрд╛</span>
                <span class="mantra-word" data-word="рд╣рд╛рд░реА" data-index="4">рд╣рд╛рд░реА</span>
            </div>
        </div>

        <!-- Counter Section -->
        <div class="counter-section">
            <div class="datetime-section">
                <div class="datetime-display" id="datetimeDisplay">--</div>
            </div>
            <div class="today-label">рдЖрдЬрдЪрд╛ рдЬрдк</div>
            <div class="count-display" id="countDisplay">0</div>
            <div class="mala-status" id="malaStatus">рдЬрдк рд╢реБрд░реВ рдХрд░реЗрдВ</div>
            <div class="total-malas" id="totalMalas">рдХреБрд▓ рдорд╛рд▓рд╛: 0</div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-section">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text">
                <span id="remainingCount">108 рдЬрдк</span> рдмрд╛рдХреА
            </div>
        </div>

        <!-- Control Buttons -->
        <div class="controls">
            <button class="btn btn-primary" id="startBtn" onclick="handleStartClick(event)">
                ЁЯОд рдЬрдк рд╢реБрд░реВ рдХрд░реЗрдВ
            </button>
            <button class="btn btn-secondary" id="stopBtn" disabled onclick="handleStopClick(event)">
                тП╣я╕П рд░реЛрдХреЗрдВ
            </button>
            <button class="btn btn-manual" id="manualBtn" onclick="handleManualClick(event)">
                тЮХ рдореИрдиреНрдпреБрдЕрд▓ рдЧрд┐рдирддреА
            </button>
            <button class="btn btn-danger" id="resetBtn" onclick="handleResetClick(event)">
                ЁЯФД рд░реАрд╕реЗрдЯ
            </button>
        </div>

        <!-- Status Section -->
        <div class="status-section">
            <div class="listening-status" id="listeningStatus">
                ЁЯОд рдорд╛рдЗрдХреНрд░реЛрдлреЛрди рддреИрдпрд╛рд░ рд╣реИ
            </div>
            <div class="recognition-text" id="recognitionText">
                рдордВрддреНрд░ рдмреЛрд▓рдирд╛ рд╢реБрд░реВ рдХрд░реЗрдВ...
            </div>
        </div>

        <!-- Statistics Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">рд╕рддреНрд░ рд╕рдордп</div>
                <div class="stat-value" id="sessionTime">0 рдорд┐рдирдЯ</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">рдЖрдЬ рдХреЗ рдЬрдк</div>
                <div class="stat-value" id="todayCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">рдЗрд╕ рд╕рдкреНрддрд╛рд╣</div>
                <div class="stat-value" id="weekCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">рд╕рдЯреАрдХрддрд╛</div>
                <div class="stat-value" id="accuracy">--</div>
            </div>
        </div>

        <!-- Full Jap Till Now Card -->
        <div class="full-jap-card">
            <div class="full-jap-label">рдЖрдЬрддрдХ рдЬрдк</div>
            <div class="full-jap-value" id="fullJapCount">0</div>
            <div class="full-jap-subtitle">рдХреБрд▓ рдЬрдк рдХреА рд╕рдВрдЦреНрдпрд╛</div>
        </div>

        <!-- Keyboard Shortcuts Info -->
        <div style="margin-top: 30px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 15px; border: 1px solid rgba(255,255,255,0.1);">
            <h3 style="color: #ffd700; margin-bottom: 10px; font-size: 1.1rem;">тМия╕П рдХреАрдмреЛрд░реНрдб рд╢реЙрд░реНрдЯрдХрдЯ:</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem; color: rgba(255,255,255,0.7);">
                <div>тАв <kbd style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 3px;">Space</kbd> - рдЬрдк рд╢реБрд░реВ рдХрд░реЗрдВ</div>
                <div>тАв <kbd style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 3px;">Esc</kbd> - рдЬрдк рд░реЛрдХреЗрдВ</div>
                <div>тАв <kbd style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 3px;">Ctrl + Enter</kbd> - рдореИрдиреНрдпреБрдЕрд▓ рдЧрд┐рдирддреА</div>
            </div>
        </div>
    </div>

    <!-- Celebration Overlay -->
    <div class="celebration" id="celebration" style="display: none;">
        <div class="celebration-text">ЁЯОЙ рдорд╛рд▓рд╛ рдкреВрд░реНрдг рд╣реБрдИ! ЁЯОЙ</div>
        <div class="celebration-subtext">рдЬрдп рд╢реНрд░реА рд░рд╛рдо!</div>
    </div>

    <!-- Load JavaScript -->
    <script src="{{ url_for('static', filename='js/harijap.js') }}"></script>
    
    <!-- Immediate button handlers (fallback) -->
    <script>
        // Immediate handlers that work even if main script fails
        function handleStartClick(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('ЁЯФ┤ INLINE onclick handler triggered for startBtn');
            if (window.hariJapCounter && typeof window.hariJapCounter.startListening === 'function') {
                window.hariJapCounter.startListening();
            } else {
                console.error('тЭМ hariJapCounter not ready, retrying...');
                setTimeout(() => {
                    if (window.hariJapCounter && typeof window.hariJapCounter.startListening === 'function') {
                        window.hariJapCounter.startListening();
                    } else {
                        alert('рдЬрдк рд╢реБрд░реВ рдХрд░рдиреЗ рдореЗрдВ рд╕рдорд╕реНрдпрд╛ред рдХреГрдкрдпрд╛ рдкреГрд╖реНрда рдХреЛ рд░реАрдлреНрд░реЗрд╢ рдХрд░реЗрдВред');
                    }
                }, 500);
            }
            return false;
        }
        
        function handleStopClick(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('ЁЯФ┤ INLINE onclick handler triggered for stopBtn');
            if (window.hariJapCounter && typeof window.hariJapCounter.stopListening === 'function') {
                window.hariJapCounter.stopListening();
            }
            return false;
        }
        
        function handleManualClick(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('ЁЯФ┤ INLINE onclick handler triggered for manualBtn');
            if (window.hariJapCounter && typeof window.hariJapCounter.addManualCount === 'function') {
                window.hariJapCounter.addManualCount();
            }
            return false;
        }
        
        function handleResetClick(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('ЁЯФ┤ INLINE onclick handler triggered for resetBtn');
            if (window.hariJapCounter && typeof window.hariJapCounter.confirmReset === 'function') {
                window.hariJapCounter.confirmReset();
            }
            return false;
        }
        
        // Also attach event listeners immediately (before DOMContentLoaded)
        (function() {
            function attachImmediateHandlers() {
                const startBtn = document.getElementById('startBtn');
                const stopBtn = document.getElementById('stopBtn');
                const manualBtn = document.getElementById('manualBtn');
                const resetBtn = document.getElementById('resetBtn');
                
                if (startBtn) {
                    console.log('тЬЕ Found startBtn, attaching immediate handlers');
                    startBtn.style.pointerEvents = 'auto';
                    startBtn.style.cursor = 'pointer';
                    startBtn.style.zIndex = '9999';
                    startBtn.style.position = 'relative';
                    
                    // Multiple event types
                    ['click', 'mousedown', 'touchstart'].forEach(eventType => {
                        startBtn.addEventListener(eventType, function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('ЁЯОп Immediate handler triggered:', eventType);
                            if (window.hariJapCounter && typeof window.hariJapCounter.startListening === 'function') {
                                window.hariJapCounter.startListening();
                            }
                        }, { capture: true, passive: false });
                    });
                }
                
                if (stopBtn) {
                    stopBtn.style.pointerEvents = 'auto';
                    stopBtn.style.cursor = 'pointer';
                    stopBtn.style.zIndex = '9999';
                    stopBtn.style.position = 'relative';
                    ['click', 'mousedown', 'touchstart'].forEach(eventType => {
                        stopBtn.addEventListener(eventType, function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            if (window.hariJapCounter && typeof window.hariJapCounter.stopListening === 'function') {
                                window.hariJapCounter.stopListening();
                            }
                        }, { capture: true, passive: false });
                    });
                }
                
                if (manualBtn) {
                    manualBtn.style.pointerEvents = 'auto';
                    manualBtn.style.cursor = 'pointer';
                    manualBtn.style.zIndex = '9999';
                    manualBtn.style.position = 'relative';
                    ['click', 'mousedown', 'touchstart'].forEach(eventType => {
                        manualBtn.addEventListener(eventType, function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            if (window.hariJapCounter && typeof window.hariJapCounter.addManualCount === 'function') {
                                window.hariJapCounter.addManualCount();
                            }
                        }, { capture: true, passive: false });
                    });
                }
                
                if (resetBtn) {
                    resetBtn.style.pointerEvents = 'auto';
                    resetBtn.style.cursor = 'pointer';
                    resetBtn.style.zIndex = '9999';
                    resetBtn.style.position = 'relative';
                    ['click', 'mousedown', 'touchstart'].forEach(eventType => {
                        resetBtn.addEventListener(eventType, function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            if (window.hariJapCounter && typeof window.hariJapCounter.confirmReset === 'function') {
                                window.hariJapCounter.confirmReset();
                            }
                        }, { capture: true, passive: false });
                    });
                }
            }
            
            // Try immediately
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', attachImmediateHandlers);
            } else {
                attachImmediateHandlers();
            }
            
            // Also try after a short delay
            setTimeout(attachImmediateHandlers, 100);
            setTimeout(attachImmediateHandlers, 500);
            setTimeout(attachImmediateHandlers, 1000);
        })();
    </script>
</body>
</html>
