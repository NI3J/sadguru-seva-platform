<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Radhe Krishna Japa Sadhana - Voice-guided mantra chanting with speech recognition">
    <meta name="keywords" content="japa, sadhana, radhe krishna, mantra, meditation, chanting">
    <meta name="author" content="Sadguru Seva Platform">
    <title>ЁЯЩП рдЬрдк рд╕рд╛рдзрдирд╛ | Radhe Krishna Japa Sadhana</title>

    <!-- CSS Files -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/japa.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Favicon and Icons -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='apple-touch-icon.png') }}">

    <!-- Meta tags for PWA -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Japa Sadhana">
</head>
<body>
<div class="container">
    <!-- Header -->
    <header class="header">
        <h1 class="title">ЁЯЩП рдЬрдк рд╕рд╛рдзрдирд╛</h1>
        <p class="subtitle">рд░рд╛рдзреЗ рдХреГрд╖реНрдгрд╛ рдордВрддреНрд░ рдЬрдк - Voice Guided Chanting</p>
    </header>

    <!-- Stats Section -->
    <div class="stats-container">
        <div class="stat-card" title="рдЬрдк рд╕рдВрдЦреНрдпрд╛">
            <div class="stat-number" id="dailyWords">{{ daily_words or 0 }}</div>
            <div class="stat-label">рдЖрдЬрдЪреА рдЬрдк рд╕рдВрдЦреНрдпрд╛</div>
        </div>
        <div class="stat-card" title="рдкреБрд░реНрдг рдХреЗрд▓реЗрд▓реЗ рд░рд╛рдЙрдВрдб">
            <div class="stat-number" id="dailyRounds">{{ daily_rounds or 0 }}</div>
            <div class="stat-label">рдЖрдЬрдЪреЗ рд░рд╛рдЙрдВрдб</div>
        </div>
        <div class="stat-card" title="рд╣реНрдпрд╛ рд╕рддреНрд░рд╛рдордзреНрдпреЗ рдХреЗрд▓реЗрд▓реА рдЬрдк рд╕рдВрдЦреНрдпрд╛">
            <div class="stat-number" id="sessionCount">{{ current_count or 0 }}</div>
            <div class="stat-label">рд╕рддреНрд░рд╛рддреАрд▓ рдЬрдк</div>
        </div>
        {% if lifetime_rounds is defined and lifetime_words is defined %}
        <div class="stat-card" title="рдкреБрд░реНрдг рдЬрд┐рд╡рди рдкреНрд░рд╡рд╛рд╕рд╛рддреАрд▓ рд░рд╛рдЙрдВрдб">
            <div class="stat-number" id="lifetimeRounds">{{ lifetime_rounds or 0 }}</div>
            <div class="stat-label"> рдкреБрд░реНрдг рд░рд╛рдЙрдВрдб</div>
        </div>
        <div class="stat-card" title="рдкреБрд░реНрдг рдЬрд┐рд╡рди рдкреНрд░рд╡рд╛рд╕рд╛рддреАрд▓ рдЬрдк рд╕рдВрдЦреНрдпрд╛">
            <div class="stat-number" id="lifetimeWords">{{ lifetime_words or 0 }}</div>
            <div class="stat-label">рдкреБрд░реНрдг рдЬрдк</div>
        </div>
        {% endif %}
    </div>

    <!-- Main Japa Area -->
    <div class="japa-container">
        <!-- Current Expected Word Display -->
        <div class="current-word-display">
            <h3>рдЕрдЧрд▓рд╛ рд╢рдмреНрдж рдмреЛрд▓реЗрдВ:</h3>
            <div class="expected-word" id="expectedWord">
                {% if mantra_words and (1 <= current_word_index <= mantra_words|length) %}
                    <span class="devanagari" id="expectedDevanagari" role="main">
                        {{ mantra_words[current_word_index - 1].word_devanagari }}
                    </span>
                    <span class="english" id="expectedEnglish" role="complementary">
                        ({{ mantra_words[current_word_index - 1].word_english }})
                    </span>
                {% else %}
                    <span class="devanagari" id="expectedDevanagari" role="main">рд░рд╛рдзреЗ</span>
                    <span class="english" id="expectedEnglish" role="complementary">(radhe)</span>
                {% endif %}
            </div>
            <div class="word-progress" role="status" aria-live="polite">
                <span id="wordProgress">{{ current_word_index or 1 }}/16</span>
            </div>
        </div>

        <!-- Full Mantra Display -->
        <div class="mantra-box" id="mantraBox" role="region" aria-label="рдкреВрд░рд╛ рдордВрддреНрд░">
            <div class="mantra-text" id="mantraText">
                {% if mantra_words %}
                    {% for word in mantra_words %}
                        <span class="mantra-word"
                              data-word-order="{{ word.word_order }}"
                              data-word-english="{{ word.word_english }}"
                              data-word-devanagari="{{ word.word_devanagari }}"
                              title="{{ word.word_english }}"
                              tabindex="0">
                            {{ word.word_devanagari }}
                        </span>
                    {% endfor %}
                {% else %}
                    <span class="mantra-word" data-word-order="1" data-word-english="radhe" title="radhe">рд░рд╛рдзреЗ</span>
                    <span class="mantra-word" data-word-order="2" data-word-english="krishna" title="krishna">рдХреГрд╖реНрдгрд╛</span>
                    <span class="mantra-word" data-word-order="3" data-word-english="shyam" title="shyam">рд╢реНрдпрд╛рдо</span>
                    <span class="mantra-word" data-word-order="4" data-word-english="shama" title="shama">рд╢рд╛рдорд╛</span>
                {% endif %}
            </div>
        </div>

        <!-- Voice Controls -->
        <div class="controls-container" role="region" aria-label="рдирд┐рдпрдВрддреНрд░рдг">
            <button class="voice-btn" id="startBtn"
                    title="рдЬрдкрд╛рд▓рд╛ рд╕реБрд░рд╡рд╛рдд рдХрд░рд╛ рд╕реНрдкреЗрд╕ рджрд╛рдмрд╛"
                    aria-label="рдЬрдк рд╕реБрд░рд╡рд╛рдд рдХрд░рд╛">
                <div class="mic-icon" aria-hidden="true">ЁЯОд</div>
                <span>рдЬрдк рд╕реБрд░реБрд╡рд╛рдд рдХрд░рд╛</span>
            </button>
            <button class="voice-btn stop-btn" id="stopBtn"
                    style="display:none;"
                    title="рдЬрдкрд╛рд▓рд╛ рдерд╛рдВрдмрд╡рд╛ (Escape рджрд╛рдмрд╛)"
                    aria-label="рдЬрдкрд╛рд▓рд╛ рдерд╛рдВрдмрд╡рд╛">
                <div class="stop-icon" aria-hidden="true">тП╣</div>
                <span>рдЬрдк рдерд╛рдВрдмрд╡рд╛</span>
            </button>

            <div class="voice-status" id="voiceStatus" role="status" aria-live="polite">
                рдорд╛рдЗрдХреНрд░реЛрдлреЛрди рддрдпрд╛рд░ рдЖрд╣реЗред рд╕реБрд░реБрд╡рд╛рдд рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдмрдЯрди рджрд╛рдмрд╛
            </div>
            <form method="POST" action="/auth/japa/logout" style="text-align: right;">
            <button type="submit" class="btn btn-outline-danger">
            ЁЯЪк рд╕рддреНрд░ рд╕рдорд╛рдкреНрдд рдХрд░реЗрдВ
            </button>
            </form>

            <div class="recognition-feedback" id="recognitionFeedback"
                 style="display:none;" role="alert" aria-live="assertive">
            </div>
            </div>

        <!-- Progress Ring -->
        <div class="progress-container">
            <div class="progress-ring" id="counterRing" role="progressbar"
                 aria-valuenow="{{ current_word_index or 1 }}"
                 aria-valuemin="1"
                 aria-valuemax="16"
                 aria-label="рдордВрддреНрд░ рдкреНрд░рдЧрддрд┐">
                <div class="progress-text">
                    <span class="progress-number" id="progressNumber">{{ current_word_index or 1 }}</span>
                    <span class="progress-label">/ 16</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Instructions -->
    <div class="instructions" role="region" aria-labelledby="instructions-heading">
        <h3 id="instructions-heading">ЁЯУЛ рдЙрдкрдпреЛрдЧ рдирд┐рд░реНрджреЗрд╢:</h3>
        <ul>
            <li>рдорд╛рдЗрдХ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВ рдФрд░ "рдЬрдк рдкреНрд░рд╛рд░рдВрдн рдХрд░реЗрдВ" рдмрдЯрди рджрдмрд╛рдПрдВ</li>
            <li>рдКрдкрд░ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╢рдмреНрдж рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдмреЛрд▓реЗрдВ (рд╣рд┐рдВрджреА рдпрд╛ рдЕрдВрдЧреНрд░реЗрдЬреА рдореЗрдВ)</li>
            <li>рд╕рд╣реА рд╢рдмреНрдж рдмреЛрд▓рдиреЗ рдкрд░ рдЕрдЧрд▓рд╛ рд╢рдмреНрдж рджрд┐рдЦреЗрдЧрд╛</li>
            <li>16 рд╢рдмреНрдж рдкреВрд░реЗ рд╣реЛрдиреЗ рдкрд░ рдПрдХ рд░рд╛рдЙрдВрдб рдкреВрд░рд╛ рд╣реЛрдЧрд╛</li>
            <li>рдмреЗрд╣рддрд░ рдкрд╣рдЪрд╛рди рдХреЗ рд▓рд┐рдП рд╢рд╛рдВрдд рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдмреЛрд▓реЗрдВ</li>
            <li>рдХреАрдмреЛрд░реНрдб рд╢реЙрд░реНрдЯрдХрдЯ: рд╕реНрдкреЗрд╕рдмрд╛рд░ (рд╢реБрд░реВ), Escape (рд░реЛрдХреЗрдВ)</li>
        </ul>
    </div>

    <!-- Pronunciation Guide -->
    <div class="instructions" style="margin-top: 20px;" role="region" aria-labelledby="pronunciation-heading">
        <h3 id="pronunciation-heading">ЁЯЧгя╕П рдЙрдЪреНрдЪрд╛рд░рдг рдЧрд╛рдЗрдб:</h3>
        <ul>
            <li><strong>рд░рд╛рдзреЗ</strong> - "Radhe", "Radhe", "рд░рд╛рдзреЗрдп" рдХрд╣реЗрдВ</li>
            <li><strong>рдХреГрд╖реНрдгрд╛</strong> - "Krishna", "Krishna", "рдХреГрд╖реНрдгрд╛" рдХрд╣реЗрдВ</li>
            <li><strong>рд╢реНрдпрд╛рдо</strong> - "Shyam", "Shyam", "рд╢реНрдпрд╛рдо" рдХрд╣реЗрдВ</li>
            <li><strong>рд╢рд╛рдорд╛</strong> - "Shama", "Shama", "рд╢рд╛рдорд╛" рдХрд╣реЗрдВ</li>
        </ul>
    </div>

    <!-- System Status -->
    <div class="instructions" style="margin-top: 20px; text-align: center;" role="region" aria-labelledby="system-status">
        <h3 id="system-status">тЪб рд╕рд┐рд╕реНрдЯрдо рд╕реНрдерд┐рддрд┐:</h3>
        <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-top: 15px;">
            <div style="display: flex; align-items: center; gap: 8px;">
                <span id="micStatus">ЁЯОд</span>
                <span id="micStatusText">рдорд╛рдЗрдХ рддреИрдпрд╛рд░</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
                <span id="networkStatus">ЁЯМР</span>
                <span id="networkStatusText">рдСрдирд▓рд╛рдЗрди</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
                <span id="speechStatus">ЁЯЧгя╕П</span>
                <span id="speechStatusText">рд╡реЙрдЗрд╕ рд░рд┐рдХрдЧреНрдирд┐рд╢рди рддреИрдпрд╛рд░</span>
            </div>
        </div>
    </div>

    <!-- Error Display -->
    {% if error %}
    <div class="error-message" role="alert">
        тЭМ рддреНрд░реБрдЯрд┐: {{ error }}
        <br><small>рдХреГрдкрдпрд╛ рдкреЗрдЬ рдХреЛ рд░рд┐рдлреНрд░реЗрд╢ рдХрд░реЗрдВ рдпрд╛ рддрдХрдиреАрдХреА рд╕рд╣рд╛рдпрддрд╛ рд▓реЗрдВ</small>
    </div>
    {% endif %}

    <!-- Hidden data for JavaScript -->
    <script type="application/json" id="mantraWordsData">
        {{ mantra_words | tojson | safe }}
    </script>

    <!-- Additional metadata for JavaScript -->
    <script type="application/json" id="configData">
        {
            "totalWords": {{ mantra_words|length if mantra_words else 16 }},
            "currentWordIndex": {{ current_word_index or 1 }},
            "sessionCount": {{ current_count or 0 }},
            "dailyStats": {
                "words": {{ daily_words or 0 }},
                "rounds": {{ daily_rounds or 0 }}
            },
            "lifetimeStats": {
                "words": {{ lifetime_words or 0 }},
                "rounds": {{ lifetime_rounds or 0 }}
            },
            "supportedLanguages": ["hi-IN", "en-IN", "en-US"],
            "version": "2.0.0"
        }
    </script>
</div>

<!-- Loading overlay -->
<div id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
    <div>
        <div style="width: 50px; height: 50px; border: 3px solid transparent; border-top: 3px solid #fff; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
        <div>рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рд╣реЛ рд░рд╣рд╛ рд╣реИ...</div>
    </div>
</div>

<!-- JavaScript -->
<script src="{{ url_for('static', filename='js/japa.js') }}"></script>

<!-- Service Worker for offline capability (optional) -->
<script>
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js').catch(err => {
            console.log('ServiceWorker registration failed: ', err);
        });
    }

    // Update system status indicators
    function updateSystemStatus() {
        // Network status
        const networkStatus = document.getElementById('networkStatus');
        const networkStatusText = document.getElementById('networkStatusText');
        if (navigator.onLine) {
            networkStatus.textContent = 'ЁЯЯв';
            networkStatusText.textContent = 'рдСрдирд▓рд╛рдЗрди';
        } else {
            networkStatus.textContent = 'ЁЯФ┤';
            networkStatusText.textContent = 'рдСрдлрд▓рд╛рдЗрди';
        }

        // Speech recognition status
        const speechStatus = document.getElementById('speechStatus');
        const speechStatusText = document.getElementById('speechStatusText');
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            speechStatus.textContent = 'тЬЕ';
            speechStatusText.textContent = 'рд╡реЙрдЗрд╕ рд░рд┐рдХрдЧреНрдирд┐рд╢рди рдЙрдкрд▓рдмреНрдз';
        } else {
            speechStatus.textContent = 'тЭМ';
            speechStatusText.textContent = 'рд╡реЙрдЗрд╕ рд░рд┐рдХрдЧреНрдирд┐рд╢рди рдЕрдиреБрдкрд▓рдмреНрдз';
        }
    }

    // Update status on load and network changes
    document.addEventListener('DOMContentLoaded', updateSystemStatus);
    window.addEventListener('online', updateSystemStatus);
    window.addEventListener('offline', updateSystemStatus);
</script>
</body>
</html>

